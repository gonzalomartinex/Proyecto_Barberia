{% extends 'base.html' %}
{% load static %}

{% block title %}Archivos Excel - Cortes Con Historia{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-gold mb-2">
                        <i class="bi bi-file-earmark-excel"></i> Archivos Excel de Turnos
                    </h1>
                    <p class="lead text-muted">
                        Gestiona y descarga todos los archivos Excel de turnos archivados
                    </p>
                </div>
                <div>
                    <a href="{% url 'archivar-turnos' %}" class="btn btn-outline-gold">
                        <i class="bi bi-archive"></i> Volver a Archivado
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas rápidas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <i class="bi bi-files display-4 text-gold"></i>
                    <h3 class="mt-2">{{ total_archivos }}</h3>
                    <p class="text-muted mb-0">Archivos Totales</p>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5><i class="bi bi-info-circle"></i> Información</h5>
                    <p class="mb-0">
                        Aquí puedes ver todos los archivos Excel generados por el sistema de archivado. 
                        Los archivos están ordenados por fecha de creación, con los más recientes primero.
                        Haz clic en cualquier nombre de archivo para descargarlo.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de archivos -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-gold text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-list-ul"></i> Lista de Archivos Excel
                    </h5>
                </div>
                <div class="card-body">
                    {% if archivos %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th><i class="bi bi-file-earmark-excel"></i> Archivo</th>
                                    <th><i class="bi bi-calendar-date"></i> Fecha Creación</th>
                                    <th><i class="bi bi-hdd"></i> Tamaño</th>
                                    <th><i class="bi bi-tag"></i> Tipo</th>
                                    <th><i class="bi bi-info-circle"></i> Descripción</th>
                                    <th><i class="bi bi-download"></i> Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for archivo in archivos %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-file-earmark-excel text-success me-2 fs-5"></i>
                                            <div>
                                                <strong>{{ archivo.nombre }}</strong>
                                                {% if 'historial' in archivo.nombre|lower %}
                                                <span class="badge bg-warning text-dark ms-2">Maestro</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="text-muted">{{ archivo.fecha_creacion|date:"d/m/Y" }}</span><br>
                                        <small class="text-muted">{{ archivo.fecha_creacion|time:"H:i:s" }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ archivo.tamaño_mb }} MB</span>
                                    </td>
                                    <td>
                                        {% if archivo.tipo == 'Historial Maestro' %}
                                        <span class="badge bg-warning text-dark">{{ archivo.tipo }}</span>
                                        {% else %}
                                        <span class="badge bg-info">{{ archivo.tipo }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ archivo.descripcion }}</small>
                                    </td>
                                    <td>
                                        <a href="{% url 'descargar-archivo-excel' archivo.nombre %}" 
                                           class="btn btn-sm btn-success" 
                                           title="Descargar {{ archivo.nombre }}">
                                            <i class="bi bi-download"></i> Descargar
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                        <h3 class="mt-3 text-muted">No hay archivos Excel</h3>
                        <p class="text-muted">
                            Aún no se han generado archivos de archivado. 
                            <a href="{% url 'archivar-turnos' %}" class="text-gold">Crear el primer archivo</a>
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Navegación -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex justify-content-between">
                <a href="{% url 'admin-panel' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Volver a Administración
                </a>
                <div>
                    <a href="{% url 'archivar-turnos' %}" class="btn btn-gold">
                        <i class="bi bi-archive"></i> Archivar Más Turnos
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.btn-gold {
    background-color: var(--gold-color, #d4af37);
    border-color: var(--gold-color, #d4af37);
    color: white;
}

.btn-gold:hover {
    background-color: #b8941f;
    border-color: #b8941f;
    color: white;
}

.btn-outline-gold {
    color: var(--gold-color, #d4af37);
    border-color: var(--gold-color, #d4af37);
}

.btn-outline-gold:hover {
    background-color: var(--gold-color, #d4af37);
    border-color: var(--gold-color, #d4af37);
    color: white;
}

.text-gold {
    color: var(--gold-color, #d4af37) !important;
}

.bg-gold {
    background-color: var(--gold-color, #d4af37) !important;
}

.card-header.bg-gold {
    border-bottom: 1px solid rgba(255,255,255,0.2);
}
</style>
{% endblock %}
